{% extends "base_project.html" %}
{% load compress humanize static hc_extras %}

{% block title %}Zammad Integration for {{ site_name }}{% endblock %}


{% block content %}
<div class="row">
    <div class="col-sm-12">
        <h1>Zammad</h1>
        <div class="jumbotron">
            <p>
            <a href="https://zammad.com/">Zammad</a> is a web-based, open source user support/ticketing solution. If you use or plan on using zammad,
            you can can integrate it with your {{ site_name }} account in few simple steps. This integration will utilize the <em>/api/v1/tickets</em> endpoint
            of zammad to create a new ticket if a healtcheck goes down.
            </p>
        </div>

        <h2>Integration Settings</h2>

        <form method="post" class="form-horizontal">
            {% csrf_token %}
            <div class="form-group {{ form.url.css_classes }}">
                <label for="url" class="col-sm-3 control-label">Server URL</label>
                <div class="col-sm-6">
                    <input
                        id="url"
                        name="url"
                        type="text"
                        class="form-control"
                        placeholder="https://"
                        value="{{ form.url.value|default:'https://' }}"
                        required>

                    {% if form.url.errors %}
                    <div class="help-block">{{ form.url.errors|join:"" }}</div>
                    {% else %}
                    <div class="help-block">Zammad server's root URL, <em>without</em> the api endpoint like https://example.zammad.com</div>
                    {% endif %}
                </div>
            </div>

            <div class="form-group {{ form.token.css_classes }}">
                <label for="token" class="col-sm-3 control-label">Personal Access Token</label>
                <div class="col-sm-6">
                    <input
                        id="token"
                        name="token"
                        type="text"
                        class="form-control"
                        value="{{ form.token.value|default:'' }}">

                    {% if form.token.errors %}
                    <div class="help-block">{{ form.token.errors|join:"" }}</div>
                    {% else %}
                    <div class="help-block">Create a personal access token with the permission <strong>ticket.agent</strong>.</div>
                    {% endif %}
                </div>
            </div>

            <div class="form-group {{ form.customer.css_classes }}">
                <label for="customer" class="col-sm-3 control-label">User to create the ticket with</label>
                <div class="col-sm-6">
                    <input
                        id="customer"
                        name="customer"
                        type="text"
                        class="form-control"
                        value="{{ form.customer.value|default:'healthchecks@example.com' }}">

                    {% if form.customer.errors %}
                    <div class="help-block">{{ form.customer.errors|join:"" }}</div>
                    {% else %}
                    <div class="help-block">Zammad requires a user to create the ticket for. Create one and paste the email here.</div>
                    {% endif %}
                </div>
            </div>

            <div class="form-group {{ form.group.css_classes }}">
                <label for="group" class="col-sm-3 control-label">Group to create the ticket in</label>
                <div class="col-sm-6">
                    <input
                        id="group"
                        name="group"
                        type="text"
                        class="form-control"
                        value="{{ form.group.value|default:'' }}">

                    {% if form.group.errors %}
                    <div class="help-block">{{ form.group.errors|join:"" }}</div>
                    {% else %}
                    <div class="help-block">Zammad requires a ticket to create a ticket for. Paste the name here.</div>
                    {% endif %}
                </div>
            </div>

            <div class="form-group">
                <div class="col-sm-offset-3 col-sm-9">
                    <button type="submit" class="btn btn-primary">Save Integration</button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
{% compress js %}
<script src="{% static 'js/selectize.min.js' %}"></script>
{% endcompress %}
{% endblock %}
